<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="robots" content="noindex, nofollow">
</head>
<body>
<script>
function getUTMParamsFromUrl() {
    const params = new URLSearchParams(window.location.search);
    return {
        source: params.get('utm_source'),
        medium: params.get('utm_medium'),
        campaign: params.get('utm_campaign'),
        term: params.get('utm_term'),
        content: params.get('utm_content'),
        domain: params.get('domain') || document.referrer
    };
}

function setTrackingData() {
    const utmParams = getUTMParamsFromUrl();
    const trackingData = {
        ...utmParams,
        timestamp: Date.now(),
        expiry: Date.now() + (365 * 24 * 60 * 60 * 1000)
    };
    
    localStorage.setItem(storageKey, JSON.stringify(trackingData));
}

function getTrackingData() {
    try {
        const data = JSON.parse(localStorage.getItem(storageKey));
        return data;
    } catch (e) {
        console.error('Error parsing cookie:', e);
    }

    return null;
}

// Handle URL actions
const urlParams = new URLSearchParams(window.location.search);
const action = urlParams.get('action');
const site = urlParams.get('site');
const storageKey = 'utm_tracking_' + site;

if(site && action) {
    if (action === 'set') {
        setTrackingData();
    } else if (action === 'get') {
        if (window !== window.top) {
            window.parent.postMessage({
                type: 'UTM_DATA',
                data: getTrackingData()
            }, '*');
        }
    }
}
</script>
</body>
</html>